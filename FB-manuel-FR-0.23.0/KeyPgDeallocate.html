<html>
<head>
<title>Deallocate</title>
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<div id="fb_body_wrapper">
<div id="fb_tab">
<div id="fb_tab_l">Deallocate</div>
<div id="fb_tab_r">&nbsp;<img src="images/fblogo_mini.gif" /></div> 
</div> 
<div id="fb_pg_wrapper">
<div id="fb_pg_body">
	Lib&egrave;re la m&eacute;moire pr&eacute;c&eacute;demment allou&eacute;e<br \>
<br \>
<div class="fb_sect_title">Syntaxe</div><div class="fb_sect_cont"><tt><br \>
<a href="KeyPgDeclare.html">Declare</a> <a href="KeyPgSub.html">Sub</a> <b>Deallocate</b> <a href="KeyPgCdecl.html">cdecl</a> ( <a href="KeyPgByval.html">ByVal</a> <i>pointer</i> <a href="KeyPgAs.html">As</a> <a href="KeyPgAny.html">Any</a> <a href="KeyPgPtr.html">Ptr</a> )<br \>
</tt><br \>
</div><div class="fb_sect_title">Usage</div><div class="fb_sect_cont"><tt><br \>
<b>Deallocate</b>( <i>pointer</i> )<br \>
</tt><br \>
</div><div class="fb_sect_title">Param&egrave;tres</div><div class="fb_sect_cont"><br \>
<tt><i>pointer</i></tt><br \>
<div class="fb_indent">l'adresse de la m&eacute;moire tampon pr&eacute;c&eacute;demment allou&eacute;e.<br \>
<br \>
</div></div><div class="fb_sect_title">Description</div><div class="fb_sect_cont"><br \>
Cette proc&eacute;dure lib&egrave;re de la m&eacute;moire qui a &eacute;t&eacute; pr&eacute;c&eacute;demment allou&eacute;e avec <tt><a href="KeyPgAllocate.html">Allocate</a></tt>. <tt><i>pointer</i></tt> doit &ecirc;tre un pointeur valide. Apr&egrave;s le retour de proc&eacute;dure, <tt><i>pointer</i></tt> sera consid&eacute;r&eacute; comme invalide  (pointant vers une adresse m&eacute;moire invalide) et son utilisation se traduira par un comportement non d&eacute;fini.<br \>
<br \>
<b><tt>Deallocate</tt></b> est un alias pour la biblioth&egrave;que d'ex&eacute;cution C <b><tt>libre</tt></b>, elle n'est donc pas garantie d'&ecirc;tre "thread-safe" sur toutes les plates-formes.<br \>
<br \>
</div><div class="fb_sect_title">Exemple</div><div class="fb_sect_cont"><br \>
L'exemple suivant montre comment lib&eacute;rer de la m&eacute;moire pr&eacute;c&eacute;demment allou&eacute;e. Notez que le pointeur a la valeur nulle apr&egrave;s la d&eacute;sallocation:<br \>
<br \>
<tt><div class="freebasic">
<span class="key">Sub</span>&nbsp;<span class="wrd">DeallocateExample1</span><span class="oth">()</span><br />
&nbsp;&nbsp;&nbsp;<span class="key">Dim</span>&nbsp;<span class="key">As</span>&nbsp;<span class="key">Integer</span>&nbsp;<span class="key">Ptr</span>&nbsp;<span class="wrd">integerPtr</span>&nbsp;<span class="oth">=</span>&nbsp;<span class="key">Allocate</span><span class="oth">(</span>&nbsp;<span class="key">Len</span><span class="oth">(</span>&nbsp;<span class="key">Integer</span>&nbsp;<span class="oth">)</span>&nbsp;<span class="oth">)</span>&nbsp;&nbsp;<span class="com">''&nbsp;initialize&nbsp;pointer&nbsp;to</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;new&nbsp;memory&nbsp;address</span><br />
<br />
&nbsp;&nbsp;&nbsp;<span class="oth">*</span><span class="wrd">integerPtr</span>&nbsp;<span class="oth">=</span>&nbsp;<span class="num">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;use&nbsp;pointer</span><br />
&nbsp;&nbsp;&nbsp;<span class="key">Print</span>&nbsp;<span class="oth">*</span><span class="wrd">integerPtr</span><br />
<br />
&nbsp;&nbsp;&nbsp;<span class="key">Deallocate</span><span class="oth">(</span>&nbsp;<span class="wrd">integerPtr</span>&nbsp;<span class="oth">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;free&nbsp;memory&nbsp;back&nbsp;to&nbsp;system</span><br />
&nbsp;&nbsp;&nbsp;<span class="wrd">integerPtr</span>&nbsp;<span class="oth">=</span>&nbsp;<span class="num">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;and&nbsp;zero&nbsp;the&nbsp;pointer</span><br />
<span class="key">End</span>&nbsp;<span class="key">Sub</span><br />
<br />
&nbsp;&nbsp;&nbsp;<span class="wrd">DeallocateExample1</span><span class="oth">()</span><br />
&nbsp;&nbsp;&nbsp;<span class="key">End</span>&nbsp;<span class="num">0</span><br />
</div></tt><br />
<br \>Bien que, dans ce cas, ce ne soit pas n&eacute;cessaire -<tt><i> puisque 1&deg;) le pointeur n'est pas une r&eacute;f&eacute;rence &agrave; un autre pointeur, 2&deg;) aucun autre pointeur ne pointe sur la m&eacute;moire lib&eacute;r&eacute;e et 3&deg;) la fonction quitte imm&eacute;diatement apr&egrave;s </i></tt>- fixer le pointeur &agrave; NULL est une bonne habitude &agrave; prendre. Si la fonction lib&egrave;re la m&eacute;moire &agrave; partir d'un pointeur qui a &eacute;t&eacute; pass&eacute; par r&eacute;f&eacute;rence, dans cette circonstance, le pointeur qui a &eacute;t&eacute; utilis&eacute; dans l'appel de la fonction sera consid&eacute;r&eacute; comme invalide, et il appartient &agrave; l'appelant soit de le r&eacute;affecter ou de le configurer pour qu'il soit nul. L'exemple 3 montre comment g&eacute;rer correctement ce genre de situation et l'exemple suivant montre les effets de la d&eacute;sallocation de m&eacute;moire avec de multiples r&eacute;f&eacute;rences.<br \>
<br \>
Dans l'exemple suivant, un pointeur diff&eacute;rent est utilis&eacute; pour lib&eacute;rer la m&eacute;moire pr&eacute;c&eacute;demment allou&eacute;e.<br \>
<br \>
<tt><div class="freebasic">
<span class="com">''&nbsp;WARNING:&nbsp;"evil"&nbsp;example&nbsp;showing&nbsp;how&nbsp;things&nbsp;should&nbsp;NOT&nbsp;be&nbsp;done</span><br />
<br />
<span class="key">Sub</span>&nbsp;<span class="wrd">DeallocateExample2</span><span class="oth">()</span><br />
&nbsp;&nbsp;&nbsp;<span class="key">Dim</span>&nbsp;<span class="key">As</span>&nbsp;<span class="key">Integer</span>&nbsp;<span class="key">Ptr</span>&nbsp;<span class="wrd">integerPtr</span>&nbsp;<span class="oth">=</span>&nbsp;<span class="key">Allocate</span><span class="oth">(</span>&nbsp;<span class="key">Len</span><span class="oth">(</span>&nbsp;<span class="key">Integer</span>&nbsp;<span class="oth">)</span>&nbsp;<span class="oth">)</span>&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;initialize&nbsp;^^^&nbsp;pointer&nbsp;to&nbsp;new&nbsp;memory</span><br />
<br />
&nbsp;&nbsp;&nbsp;<span class="key">Dim</span>&nbsp;<span class="key">As</span>&nbsp;<span class="key">Integer</span>&nbsp;<span class="key">Ptr</span>&nbsp;<span class="wrd">anotherIntegerPtr</span>&nbsp;<span class="oth">=</span>&nbsp;<span class="wrd">integerPtr</span><br />
&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;initialize&nbsp;^^^&nbsp;another&nbsp;pointer&nbsp;to&nbsp;the&nbsp;same&nbsp;memory</span><br />
<br />
&nbsp;&nbsp;&nbsp;<span class="oth">*</span><span class="wrd">anotherIntegerPtr</span>&nbsp;<span class="oth">=</span>&nbsp;<span class="num">69</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;use&nbsp;other&nbsp;pointer</span><br />
&nbsp;&nbsp;&nbsp;<span class="key">Print</span>&nbsp;<span class="oth">*</span><span class="wrd">anotherIntegerPtr</span><br />
<br />
&nbsp;&nbsp;&nbsp;<span class="key">Deallocate</span><span class="oth">(</span>&nbsp;<span class="wrd">anotherIntegerPtr</span>&nbsp;<span class="oth">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;free&nbsp;memory&nbsp;back&nbsp;to&nbsp;system</span><br />
&nbsp;&nbsp;&nbsp;<span class="wrd">anotherIntegerPtr</span>&nbsp;<span class="oth">=</span>&nbsp;<span class="num">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;and&nbsp;zero&nbsp;other&nbsp;pointer</span><br />
<br />
<span class="com">''&nbsp;*integerPtr&nbsp;=&nbsp;420&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''&nbsp;undefined&nbsp;behavior;&nbsp;original</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;pointer&nbsp;is&nbsp;invalid</span><br />
<span class="key">End</span>&nbsp;<span class="key">Sub</span><br />
<br />
&nbsp;&nbsp;&nbsp;<span class="wrd">DeallocateExample2</span><span class="oth">()</span><br />
&nbsp;&nbsp;&nbsp;<span class="key">End</span>&nbsp;<span class="num">0</span><br />
</div></tt><br />
<br \>
Notez qu'apr&egrave;s la d&eacute;sallocation, <i>les deux</i> pointeurs sont invalid&eacute;s. Cela illustre une autre cause de bugs lorsque l'on travaille avec des pointeurs. En r&egrave;gle g&eacute;n&eacute;rale, ne lib&eacute;rez de la m&eacute;moire pr&eacute;c&eacute;demment allou&eacute;e que lorsque vous savez qu'il n'y a qu'un seul (1) pointeur qui pointe actuellement sur elle.<br \>
<br \>
<tt><div class="freebasic">
<span class="key">Function</span>&nbsp;<span class="wrd">createInteger</span><span class="oth">()</span>&nbsp;<span class="key">As</span>&nbsp;<span class="key">Integer</span>&nbsp;<span class="key">Ptr</span><br />
&nbsp;&nbsp;&nbsp;<span class="key">Return</span>&nbsp;<span class="key">Allocate</span><span class="oth">(</span>&nbsp;<span class="key">Len</span><span class="oth">(</span>&nbsp;<span class="key">Integer</span>&nbsp;<span class="oth">)</span>&nbsp;<span class="oth">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;return&nbsp;pointer&nbsp;to&nbsp;newly</span><br />
<span class="key">End</span>&nbsp;<span class="key">Function</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;allocated&nbsp;memory</span><br />
<br />
<span class="key">Sub</span>&nbsp;<span class="wrd">destroyInteger</span><span class="oth">(</span>&nbsp;<span class="key">ByRef</span>&nbsp;<span class="wrd">someIntegerPtr</span>&nbsp;<span class="key">As</span>&nbsp;<span class="key">Integer</span>&nbsp;<span class="key">Ptr</span>&nbsp;<span class="oth">)</span><br />
&nbsp;&nbsp;&nbsp;<span class="key">Deallocate</span><span class="oth">(</span>&nbsp;<span class="wrd">someIntegerPtr</span>&nbsp;<span class="oth">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;free&nbsp;memory&nbsp;back&nbsp;to&nbsp;system</span><br />
&nbsp;&nbsp;&nbsp;<span class="wrd">someIntegerPtr</span>&nbsp;<span class="oth">=</span>&nbsp;<span class="num">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;null&nbsp;original&nbsp;pointer</span><br />
<span class="key">End</span>&nbsp;<span class="key">Sub</span><br />
<br />
<span class="key">Sub</span>&nbsp;<span class="wrd">DeallocateExample3</span><span class="oth">()</span><br />
&nbsp;&nbsp;&nbsp;<span class="key">Dim</span>&nbsp;<span class="key">As</span>&nbsp;<span class="key">Integer</span>&nbsp;<span class="key">Ptr</span>&nbsp;<span class="wrd">integerPtr</span>&nbsp;<span class="oth">=</span>&nbsp;<span class="wrd">createInteger</span><span class="oth">()</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;initialize&nbsp;pointer&nbsp;to</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;new&nbsp;memory&nbsp;address</span><br />
<br />
&nbsp;&nbsp;&nbsp;<span class="oth">*</span><span class="wrd">integerPtr</span>&nbsp;<span class="oth">=</span>&nbsp;<span class="num">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;use&nbsp;pointer</span><br />
&nbsp;&nbsp;&nbsp;<span class="key">Print</span>&nbsp;<span class="oth">*</span><span class="wrd">integerPtr</span><br />
<br />
&nbsp;&nbsp;&nbsp;<span class="wrd">destroyInteger</span><span class="oth">(</span>&nbsp;<span class="wrd">integerPtr</span>&nbsp;<span class="oth">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;pass&nbsp;pointer&nbsp;by&nbsp;reference</span><br />
&nbsp;&nbsp;&nbsp;<span class="key">Assert</span><span class="oth">(</span>&nbsp;<span class="wrd">integerPtr</span>&nbsp;<span class="oth">=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="oth">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="com">''&nbsp;pointer&nbsp;should&nbsp;now&nbsp;be&nbsp;null</span><br />
<span class="key">End</span>&nbsp;<span class="key">Sub</span><br />
<br />
&nbsp;&nbsp;&nbsp;<span class="wrd">DeallocateExample3</span><span class="oth">()</span><br />
&nbsp;&nbsp;&nbsp;<span class="key">End</span>&nbsp;<span class="num">0</span><br />
</div></tt><br />
<br \>
Dans le programme ci-dessus, un pointeur de r&eacute;f&eacute;rence dans une fonction est fix&eacute; &agrave; null apr&egrave;s lib&eacute;ration de la m&eacute;moire sur laquelle il il pointe. Une macro <tt><a href="KeyPgAssert.html">Assert</a></tt> est utilis&eacute;e pour tester si le pointeur original est en fait nul apr&egrave;s l'appel de la fonction. Cet exemple implique que la bonne fa&ccedil;on de passer des pointeurs de fonctions qui d&eacute;sallouent la m&eacute;moire qu'ils pointent, est par r&eacute;f&eacute;rence.<br \>
<br \>           
</ul></div><div class="fb_sect_title">Diff&eacute;rences de dialecte</div><div class="fb_sect_cont"><br \>
<ul><li> Non disponible dans le dialecte <i><a href="CompilerOptlang.html">-lang qb</a></i> sauf si r&eacute;f&eacute;renc&eacute; avec l'alias <tt><b>__Deallocate</b></tt>.<br \>

</ul></ul></div><div class="fb_sect_title">Diff&eacute;rences avec QB</div><div class="fb_sect_cont"><br \>
<ul><li> Nouveau pour FreeBASIC<br \>
<br \>
</ul></div><div class="fb_sect_title">Voir aussi</div><div class="fb_sect_cont"><br \>
<ul><li> <tt><a href="KeyPgAllocate.html">Allocate</a></tt><br \>
<li> <tt><a href="KeyPgReallocate.html">Reallocate</a></tt><br \>
<br \>
</ul></div>
</div>
</div> 
</div> 
</body>
</html>
